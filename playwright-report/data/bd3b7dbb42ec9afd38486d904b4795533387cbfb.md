# Test info

- Name: Login Scenarios >> POV Client: Should successfully login with valid credentials
- Location: /Applications/api-automation-nearon/tests/Login/login.spec.ts:26:9

# Error details

```
Error: expect(received).toContain(expected) // indexOf

Expected value: "Customer"
Received array: ["MITRA"]
    at /Applications/api-automation-nearon/tests/Login/login.spec.ts:38:44
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import { LoginAPI } from '@src/api/Login/login.api';
   3 | import { ENV } from '@src/config/environment';
   4 | import { UserData } from '@src/types/login.types';
   5 | import { API_MESSAGES, API_RESPONSE_CODES } from '@src/data/api.data';
   6 | import { setClientToken, getClientToken, setAdminToken, getAdminToken } from '@src/utils/token';
   7 |
   8 | function isUserData(data: any): data is UserData {
   9 |     return (
   10 |         typeof data === 'object' &&
   11 |         'username' in data &&
   12 |         'id' in data &&
   13 |         'role' in data &&
   14 |         'projects' in data
   15 |     );
   16 | }
   17 |
   18 | test.describe('Login Scenarios', () => {
   19 |     let loginApi: LoginAPI;
   20 |
   21 |     test.beforeEach(async ({ request }) => {
   22 |         loginApi = new LoginAPI(request);
   23 |     });
   24 |
   25 |     // --- Test Cases POV Client ---
   26 |     test('POV Client: Should successfully login with valid credentials', async ({ request }) => {
   27 |         const response = await loginApi.loginAsClient();
   28 |         console.log('Response for client login:', JSON.stringify(response, null, 2));
   29 |         expect(response.code).toBe(API_RESPONSE_CODES.SUCCESS);
   30 |         expect(response.status).toBe(true);
   31 |         expect(response.message).toBe(API_MESSAGES.LOGIN.SUCCESS);
   32 |         expect(response.data).toBeDefined();
   33 |         expect(isUserData(response.data)).toBe(true);
   34 |         if (isUserData(response.data)) {
   35 |             expect(response.data.username).toBe(ENV.CREDENTIALS.VALID_USER.username);
   36 |             expect(response.data.id).toBeDefined();
   37 |             expect(response.data.role).toBeDefined();
>  38 |             expect(response.data.projects).toContain(ENV.ROLES.CLIENT);
      |                                            ^ Error: expect(received).toContain(expected) // indexOf
   39 |             console.log('User data from client login:', {
   40 |                 id: response.data.id,
   41 |                 username: response.data.username,
   42 |                 role: response.data.role,
   43 |                 projects: response.data.projects
   44 |             });
   45 |         } else {
   46 |             throw new Error('Response data is not in UserData format');
   47 |         }
   48 |         const storage = await request.storageState();
   49 |         const tokenCookie = storage.cookies.find(c => c.name === 'token');
   50 |         setClientToken(tokenCookie?.value);
   51 |         expect(getClientToken()).toBeDefined();
   52 |     });
   53 |
   54 |     test('POV Client: Should fail login when user does not exist', async () => {
   55 |         const response = await loginApi.login(ENV.CREDENTIALS.NONEXISTENT_USER);
   56 |         console.log('Response for non-existent user:', JSON.stringify(response, null, 2));
   57 |         expect(response.code).toBe(API_RESPONSE_CODES.NOT_FOUND);
   58 |         expect(response.status).toBe(false);
   59 |         expect(response.message).toBe(API_MESSAGES.LOGIN.USER_NOT_FOUND);
   60 |         expect(response.data).toBe(API_MESSAGES.LOGIN.USER_NOT_FOUND);
   61 |     });
   62 |
   63 |     test('POV Client: Should fail login when password is incorrect', async () => {
   64 |         const response = await loginApi.login(ENV.CREDENTIALS.WRONG_PASSWORD);
   65 |         console.log('Response for incorrect password:', JSON.stringify(response, null, 2));
   66 |         expect(response.code).toBe(API_RESPONSE_CODES.BAD_REQUEST);
   67 |         expect(response.status).toBe(false);
   68 |         expect(response.message).toBe(API_MESSAGES.LOGIN.PASSWORD_INCORRECT);
   69 |         expect(response.data).toBe(API_MESSAGES.LOGIN.PASSWORD_INCORRECT);
   70 |     });
   71 |
   72 |     // --- Test Cases POV Admin ---
   73 |     test('POV Admin: Should successfully login with valid credentials', async ({ request }) => {
   74 |         const response = await loginApi.loginAsAdmin();
   75 |         console.log('Response for admin login:', JSON.stringify(response, null, 2));
   76 |         expect(response.code).toBe(API_RESPONSE_CODES.SUCCESS);
   77 |         expect(response.status).toBe(true);
   78 |         expect(response.message).toBe(API_MESSAGES.LOGIN.SUCCESS);
   79 |         expect(response.data).toBeDefined();
   80 |         expect(isUserData(response.data)).toBe(true);
   81 |         if (isUserData(response.data)) {
   82 |             expect(response.data.username).toBe(ENV.CREDENTIALS.VALID_ADMIN.username);
   83 |             expect(response.data.id).toBeDefined();
   84 |             expect(response.data.role).toBeDefined();
   85 |             console.log('User data from admin login:', {
   86 |                 id: response.data.id,
   87 |                 username: response.data.username,
   88 |                 role: response.data.role,
   89 |                 projects: response.data.projects
   90 |             });
   91 |         } else {
   92 |             throw new Error('Response data is not in UserData format');
   93 |         }
   94 |         const storage = await request.storageState();
   95 |         const tokenCookie = storage.cookies.find(c => c.name === 'token');
   96 |         setAdminToken(tokenCookie?.value);
   97 |         expect(getAdminToken()).toBeDefined();
   98 |         console.log('Admin token:', getAdminToken());
   99 |     });
  100 |
  101 |     test('POV Admin: Should fail login when user does not exist', async () => {
  102 |         const response = await loginApi.login(ENV.CREDENTIALS.NONEXISTENT_ADMIN);
  103 |         console.log('Response for non-existent admin:', JSON.stringify(response, null, 2));
  104 |         expect(response.code).toBe(API_RESPONSE_CODES.NOT_FOUND);
  105 |         expect(response.status).toBe(false);
  106 |         expect(response.message).toBe(API_MESSAGES.LOGIN.USER_NOT_FOUND);
  107 |         expect(response.data).toBe(API_MESSAGES.LOGIN.USER_NOT_FOUND);
  108 |     });
  109 |
  110 |     test('POV Admin: Should fail login when password is incorrect', async () => {
  111 |         const response = await loginApi.login(ENV.CREDENTIALS.WRONG_PASSWORD_ADMIN);
  112 |         console.log('Response for incorrect admin password:', JSON.stringify(response, null, 2));
  113 |         expect(response.code).toBe(API_RESPONSE_CODES.BAD_REQUEST);
  114 |         expect(response.status).toBe(false);
  115 |         expect(response.message).toBe(API_MESSAGES.LOGIN.PASSWORD_INCORRECT);
  116 |         expect(response.data).toBe(API_MESSAGES.LOGIN.PASSWORD_INCORRECT);
  117 |     });
  118 | }); 
```